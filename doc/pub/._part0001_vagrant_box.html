<html>
<head>
<!--
This style is adopted from the (now old) vagrant 1.0 web
pages. The style builds on the Twitter Bootstrap style.
Modifications by Hans Petter Langtangen, hpl@simula.no.

This style file should be copied and the following
elements edited:

Logo heading:

 LogoWord
 withSubWord

Navigation links at the top:

 GO TO 1
 GO TO 2

Footer at the end:

 Here goes a footer, if desired, maybe with a Copyright &copy;

-->

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Doconce: http://code.google.com/p/doconce/" />

<link rel="stylesheet" href="css/twitter_bootstrap.css">
<link rel="stylesheet" href="css/vagrant.css">
<!-- Define color of headings here (last definition counts) -->
<style type="text/css">
h1, h2, h3, h4, h5, h6 {
  color: #000;     /* black */
  color: #999;     /* gray */
  color: #005580;  /* dark blue */
  color: #08c;     /* characteristic blue */
</style>
</head>
<body>

<title> Documentation of Vagrant </title>

<div class="container">
 <div class="row Header with-border">
  <div class="span3 Module logo">
   <h1><a href="/">Vagrant<span class="subtitle">4scientists</span></a></h1>
  </div>
  <div class="span9">
   <div class="Module navigation">
   <!-- Navigation at the top of the page -->
    <ul>
     <li> <a href="http://docs.vagrantup.com/v2/">Vagrant docs</a></li>
    </ul>
   </div>
  </div>
 </div>
</div>


<!-- Here goes the table of contents in the sidebar
     <li class="active"> means dark blue background for current section
-->
<div class="row">
 <div class="span3 Module sidebar">
  <div class="well" style="padding: 8px 0px;">
   <ul class="nav nav-list">
     <!-- Syntax:
     <li> <a href="...">Section 1</a></li>
     <li class="active"> <a href="...">Section 2</a></li>
     <li> &nbsp;&nbsp;&nbsp; <a href="...">Section 2a</a></li>
     <li> &nbsp;&nbsp;&nbsp; <a href="...">Section 2b</a></li>
     -->
     <!-- Doconce automatically fills in the table of contents -->
          <!-- vagrant nav toc: " Problem setting " --> <li class="active">  <a href="._part0001_vagrant_box.html#___sec0"> Problem setting </a>
     <!-- vagrant nav toc: " Contents of the Vagrant machine " --> <li> &nbsp;  <a href="._part0001_vagrant_box.html#vagrant:contents"> Contents of the Vagrant machine </a>
     <!-- vagrant nav toc: " Installing Vagrant " --> <li> &nbsp;  <a href="._part0002_vagrant_box.html#vagrant:install"> Installing Vagrant </a>
     <!-- vagrant nav toc: " Creating the Vagrant machine " --> <li>  <a href="._part0003_vagrant_box.html#___sec3"> Creating the Vagrant machine </a>
     <!-- vagrant nav toc: " Choice of operating system type " --> <li> &nbsp;  <a href="._part0003_vagrant_box.html#___sec4"> Choice of operating system type </a>
     <!-- vagrant nav toc: " Installing packages " --> <li> &nbsp;  <a href="._part0004_vagrant_box.html#___sec5"> Installing packages </a>
     <!-- vagrant nav toc: " Setting up a default environment with <code>.bashrc</code> " --> <li> &nbsp;  <a href="._part0005_vagrant_box.html#___sec6"> Setting up a default environment with <code>.bashrc</code> </a>
     <!-- vagrant nav toc: " Adding X11 support " --> <li> &nbsp;  <a href="._part0006_vagrant_box.html#___sec7"> Adding X11 support </a>
     <!-- vagrant nav toc: " Finalizing the machine " --> <li> &nbsp;  <a href="._part0006_vagrant_box.html#___sec8"> Finalizing the machine </a>
     <!-- vagrant nav toc: " Operating the Vagrant machine " --> <li>  <a href="._part0007_vagrant_box.html#___sec9"> Operating the Vagrant machine </a>
     <!-- vagrant nav toc: " Shared folders " --> <li> &nbsp;  <a href="._part0007_vagrant_box.html#vagrant:shareddir"> Shared folders </a>
     <!-- vagrant nav toc: " Troubleshooting: shared folder is invisible " --> <li> &nbsp; &nbsp;  <a href="._part0007_vagrant_box.html#___sec11"> Troubleshooting: shared folder is invisible </a>
     <!-- vagrant nav toc: " Troubleshooting: "couldn't connect to display ..." " --> <li> &nbsp; &nbsp;  <a href="._part0007_vagrant_box.html#___sec12"> Troubleshooting: "couldn't connect to display ..." </a>
     <!-- vagrant nav toc: " Stopping the Vagrant machine " --> <li> &nbsp;  <a href="._part0007_vagrant_box.html#___sec13"> Stopping the Vagrant machine </a>
     <!-- vagrant nav toc: " Using VMWare Fusion " --> <li> &nbsp;  <a href="._part0007_vagrant_box.html#___sec14"> Using VMWare Fusion </a>
     <!-- vagrant nav toc: " Documentation of Vagrant " --> <li> &nbsp;  <a href="._part0007_vagrant_box.html#___sec15"> Documentation of Vagrant </a>

    </ul>
   </div>
  </div>

  <div class="span9">


<!-- tocinfo
{'highest level': 1,
 'sections': [(' Problem setting ', 1, None, '___sec0'),
              (' Contents of the Vagrant machine ',
               2,
               'vagrant:contents',
               'vagrant:contents'),
              (' Installing Vagrant ',
               2,
               'vagrant:install',
               'vagrant:install'),
              (' Creating the Vagrant machine ', 1, None, '___sec3'),
              (' Choice of operating system type ', 2, None, '___sec4'),
              (' Installing packages ', 2, None, '___sec5'),
              (' Setting up a default environment with `.bashrc` ',
               2,
               None,
               '___sec6'),
              (' Adding X11 support ', 2, None, '___sec7'),
              (' Finalizing the machine ', 2, None, '___sec8'),
              (' Operating the Vagrant machine ', 1, None, '___sec9'),
              (' Shared folders ',
               2,
               'vagrant:shareddir',
               'vagrant:shareddir'),
              (' Troubleshooting: shared folder is invisible ',
               3,
               None,
               '___sec11'),
              (' Troubleshooting: "couldn\'t connect to display ..." ',
               3,
               None,
               '___sec12'),
              (' Stopping the Vagrant machine ', 2, None, '___sec13'),
              (' Using VMWare Fusion ', 2, None, '___sec14'),
              (' Documentation of Vagrant ', 2, None, '___sec15')]}
end of tocinfo -->





<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "AMS"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js"]
  }
});
</script>
<script type="text/javascript"
 src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- Fix slow MathJax rendering in IE8 -->
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7">




<a name="part0001"></a>
<!-- !split -->

<h2>Problem setting  <a name="___sec0"></a></h2>

<p>
We shall work with a specific example: creating a computing
environment for a short course on scientific computing. The challenge
is to minimize the amount of time the audience spends on installation
and minimize the teacher's hassle with all types of operating systems
and their versions in the audience. To reach this goal, we shall
create a Vagrant machine, which ensures that everybody is working in
exactly the same computing environment.

<h3>Contents of the Vagrant machine <a name="vagrant:contents"></a></h3>

<p>
The Vagrant machine needs to have an operating system. Here we choose
Ubuntu of one main reason: software on Ubuntu can be installed as
Debian packages, and the Debian software repository is now the richest
repository for pre-built mathematical software.

<p>
<!-- The user of the machine -->
<!-- will mostly see her own operating system and will to a limited extent -->
<!-- have intimate interaction with the Ubuntu system in the box. -->

<p>
We have developed a little tool where one can list the desired Debian
packages in a computing environment in a file with default name
<code>debkpg.txt</code>. This file may also contain plain Unix commands for
doing other types of installation, like <code>pip install</code> and
cloning of source code repositories with subsequent execution of
a <code>setup.py</code> file. Specific examples on content are listed below.

<p>
A little Python script <a href="_static/deb2sh.py"><tt>deb2sh.py</tt></a> reads the
installation specification in <a href="_static/debpkg.txt"><tt>debpkg.txt</tt></a> and
creates a Bash script <a href="_static/install.sh"><tt>install.sh</tt></a> and an
equivalent Python script <a href="_static/install.py"><tt>install.py</tt></a> for
running all the necessary operating system commands.  If any package
cannot be installed successfully, the script stops. The problem must
then be fixed, or the package must in worst case be removed (just
comment out the install line(s) in <code>install.sh</code> or <code>install.py</code>).  The
script can thereafter be rerun again.

<p>
The following is an extract of packages as they are listed
in a <code>debpkg.txt</code> file:

<p>

<!-- code=text typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"># Editors
emacs python-mode gedit vim ispell

# Compilers
gcc g++ gawk f2c gfortran
autoconf automake autotools-dev

# Numerical libraries
libatlas-base-dev libsuitesparse-dev

# Python
idle
python-pip
python-dev
# Matplotlib requires libfreetype-dev libpng-dev
# (otherwise pip install matplotlib does not work)
libfreetype6-dev libpng-dev
pip install numpy
pip install sympy
pip install matplotlib
pip install scipy

# ScientificPython must be installed from source
$ if [ ! -d srclib ]; then mkdir srclib; fi
$ cd srclib
$ hg clone https://bitbucket.org/khinsen/scientificpython
$ cd scientificpython
$ sudo python setup.py install
$ cd ../..
</pre></div>
<p>
The syntax has four elements: comment lines are just copied to the
<code>install.sh</code> and <code>install.py</code> scripts, lines starting with <code>$</code> are plain Unix
commands and also copied to the output scripts, lines starting with
<code>pip install</code> lists packages to be installed with <code>pip</code>,
while all other non-blank
lines are supposed to list the name of Debian packages to be installed
by <code>sudo apt-get install</code> commands. The examples above show all four
line types. Observe in particular how we can freely add Unix commands
to download ScientificPython from its Bitbucket repo (done in the
<code>srclib</code> subfolder/subdirectory) and install the package manually by running
<code>setup.py</code> the usual way.

<p>
Some examples on lines in the <code>install.sh</code> script are

<p>

<!-- code=bash (from !bc shcod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #408080; font-style: italic">#!/bin/bash</span>
<span style="color: #408080; font-style: italic"># Automatically generated script. Based on debpkg.txt.</span>

<span style="color: #008000; font-weight: bold">function </span>apt_install <span style="color: #666666">{</span>
  sudo apt-get -y install <span style="color: #19177C">$1</span>
  <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">[</span> <span style="color: #19177C">$?</span> -ne 0 <span style="color: #666666">]</span>; <span style="color: #008000; font-weight: bold">then</span>
<span style="color: #008000; font-weight: bold">    </span><span style="color: #008000">echo</span> <span style="color: #BA2121">&quot;could not install $1 - abort&quot;</span>
    <span style="color: #008000">exit </span>1
  <span style="color: #008000; font-weight: bold">fi</span>
<span style="color: #666666">}</span>

<span style="color: #008000; font-weight: bold">function </span>pip_install <span style="color: #666666">{</span>
  <span style="color: #008000; font-weight: bold">for </span>p in <span style="color: #19177C">$@</span>; <span style="color: #008000; font-weight: bold">do</span>
<span style="color: #008000; font-weight: bold">    </span>sudo pip install <span style="color: #19177C">$p</span>
    <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">[</span> <span style="color: #19177C">$?</span> -ne 0 <span style="color: #666666">]</span>; <span style="color: #008000; font-weight: bold">then</span>
<span style="color: #008000; font-weight: bold">      </span><span style="color: #008000">echo</span> <span style="color: #BA2121">&quot;could not install $p - abort&quot;</span>
      <span style="color: #008000">exit </span>1
    <span style="color: #008000; font-weight: bold">fi</span>
<span style="color: #008000; font-weight: bold">  done</span>
<span style="color: #666666">}</span>

sudo apt-get update

apt_install ispell
pip_install numpy
pip_install sympy
</pre></div>
<p>
<div class="alert alert-block alert-notice alert-text-normal"><b>Notice.</b>

<p>

<ul>
 <li> Installation commands may fail. Therefore we have made separate
   functions for doing the <code>apt-get</code> and <code>pip install</code> commands.
   We test the value of the environment variable <code>$?</code> after the
   installation of a package: a successful installation implies
   value of 0, while values different from 0 mean that something
   went wrong. We then abort the script with <code>exit 1</code>.</li>
 <li> The <code>apt-get install</code> will prompt the user for questions for
   every package, but here we use the option <code>-y</code> to automatically
   answer <code>yes</code> to all questions.</li>
</ul>
</div>
<p>
The corresponding lines in <code>install.py</code> are

<p>

<!-- code=python (from !bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">commands</span><span style="color: #666666">,</span> <span style="color: #0000FF; font-weight: bold">sys</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">system</span>(cmd):
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Run system command cmd.&quot;&quot;&quot;</span>
    failure, output <span style="color: #666666">=</span> commands<span style="color: #666666">.</span>getstatusoutput(cmd)
    <span style="color: #008000; font-weight: bold">if</span> failure:
       <span style="color: #008000; font-weight: bold">print</span> <span style="color: #BA2121">&#39;Command</span><span style="color: #BB6622; font-weight: bold">\n</span><span style="color: #BA2121">  </span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BB6622; font-weight: bold">\n</span><span style="color: #BA2121">failed.&#39;</span> <span style="color: #666666">%</span> cmd
       <span style="color: #008000; font-weight: bold">print</span> output
       sys<span style="color: #666666">.</span>exit(<span style="color: #666666">1</span>)

system(<span style="color: #BA2121">&#39;sudo apt-get update&#39;</span>)

system(<span style="color: #BA2121">&#39;sudo apt-get -y install ispell&#39;</span>)
system(<span style="color: #BA2121">&#39;pip install numpy&#39;</span>)
system(<span style="color: #BA2121">&#39;pip install sympy&#39;</span>)
</pre></div>
<p>
The Python script does not test the environment variable <code>$?</code>,
but the first return value from the <code>getstatusoutput</code> is basically
<code>$?</code>.

<p>
We can use <code>install.sh</code> or <code>install.py</code> to automate installation of
packages in the Vagrant machine. More powerful tools for setting
up complete software environments are <a href="http://www.opscode.com/">Chef</a>
and <a href="https://puppetlabs.com/">Puppet</a>.

<p>
In the Vagrant machine, we create two folders:

<p>

<ul>
 <li> <code>~/bin</code> for executable programs and scripts</li>
 <li> <code>~/srclib</code> for Python packages installed locally</li>
</ul>

We also include two useful files:

<p>

<ul>
 <li> A small, but illustrative <a href="_static/.bashrc"><tt>~/.bashrc</tt></a> file for
   setting up the Linux system.</li>
 <li> <a href="_static/.rsyncexclude"><tt>~/.rsyncexclude</tt></a> for excluding certain
   files when running <code>rsync</code> for copying files between machines, or
   between machines and external disks or memory sticks.</li>
</ul>

<p>
<!-- ------------------- end of main content --------------- -->


<!--
Preliminary examples/discussion on vagrant style syntax

<div class='alert alert-block alert-notice'>
  <h3>What about PHP? Python? Java?</h3>
<p>
bla-bla.
</div>

<p>
While the <div class="deep-blue">rest of the</div> getting started
-->

<ul class="pager">
  <li class="previous">
    <a href="._part0000_vagrant_box.html">&larr; Prev</a>
  </li>

  <li class="next">
    <a href="._part0002_vagrant_box.html">Next &rarr;</a>
  </li>

</ul>

 </div>

 <div class="row Footer">
  <div class="span12">
  Copyright &copy 2013; Anders E. Johansen and Hans Petter Langtangen
  </div>
 </div>
</div>
</body>
</html>



